(function(n,t,i,r){function rt(n,r,f){var o,e;if(r)i.isObject(n)?ut(n,r,f):t.isObservable(n)&&n.hasOwnProperty("push")&&lt(n,r);else if(i.isObject(n))for(o in n)e=i.cache(n[o],u),e&&e.dispose(),i.deleteCache(n[o],u);else t.isObservable(n)&&n.hasOwnProperty("push")&&(e=i.cache(n[o],u),e&&e.dispose(),i.deleteCache(n,u))}function ut(n,f,o){t.utils.arrayForEach(i.metadata.getProperties(n,o,!!f.includeAssociations),function(o){var s=n[o.name],h;t.isObservable(s)&&(h=function(){var c=this,i=null,u=function(n,t){var r={},i={};return r[o.name]=n,i[o.name]=t,{oldValues:r,newValues:i}},t=s.notifySubscribers,h=function(e,o){var h=o==="beforeChange",s=o===r||o==="change";h&&f.beforeChange&&(i=w(e)),c.skip?t.apply(this,arguments):(h?f.beforeChange&&f.beforeChange(n,"change",u(i)):s&&f.afterChange&&f.afterChange(n,"change",u(i,e)),t.apply(this,arguments),s&&f.afterEvent&&f.afterEvent(n,"change",u(i,e)))};this.skip=!1,this.dispose=function(){e(s,h,t)},e(s,t,h)},i.cache(s,u,new h))})}function lt(n,f){var o=function(i){var l=this,h=null,u=null,c=function(n,i){for(var e=null,o=t.utils.compareArrays(n,i),f,r=0,s=o.length;r<s;r++){f=null;switch(o[r].status){case"added":f="insert";break;case"deleted":f="remove";break;default:continue}if(f!==null)if(e===null)e={type:f,args:{index:r,items:[o[r].value]}};else{e={type:"replaceAll",args:{newItems:i,oldItems:n}};break}}return u=e},o=i.notifySubscribers,s=function(t,i){var s=i==="beforeChange",e=i===r||i==="change";s&&(h=w(t)),l.skip?o.apply(this,arguments):(s||e&&f.afterChange&&(c(h,t),f.afterChange(n,u.type,u.args)),o.apply(this,arguments),e&&f.afterEvent&&f.afterEvent(n,u.type,u.args))};this.skip=!1,this.dispose=function(){e(i,s,o)},e(i,o,s)};i.cache(n,u,new o(n))}function at(n,t,i){f(n,function(){h(n,t,0,i)})}function ct(n,t,i){f(n,function(){h(n,t,i)})}function st(n,t){f(n,function(){h(n,0,n().length,t)})}function ht(n,i){if(i===o||i===s)return!1;var r=n[i];return t.isObservable(r)&&r.hasOwnProperty("getDependenciesCount")?!1:!0}function d(n,i){return t.utils.unwrapObservable(n[i])}function p(n,i,r){f(n[i],function(){t.isObservable(n[i])?n[i](r):n[i]=r})}function k(n){return i.isArray(t.utils.unwrapObservable(n))}function g(n){return t.observableArray(n||[])}function it(n){return n()}function l(n,r,u,f){var o,e;return i.isArray(n)?(o=i.isValueArray(n)?n:t.utils.arrayMap(n,function(n){return(u||l)(n,r)}),t.observableArray(o)):i.isObject(n)?(e=f||{},t.utils.arrayForEach(i.metadata.getProperties(n,r,!0),function(i){var r=(u||l)(n[i.name],i.type);e[i.name]=t.isObservable(r)?r:t.observable(r)}),i.metadata.isEntityType(r)&&i.addEntityProperties(e,r),i.addUpdatedProperties(e,r),e):n}function a(n,r){var f,u;return n=t.utils.unwrapObservable(n),i.isArray(n)?f=t.utils.arrayMap(n,function(n){return a(n)}):i.isObject(n)?(u={},n.hasOwnProperty("__type")&&(u.__type=t.utils.unwrapObservable(n.__type)),t.utils.arrayForEach(i.metadata.getProperties(n,r),function(t){n.hasOwnProperty(t.name)&&(u[t.name]=a(n[t.name],t.type))}),u):n}function tt(n,i,r,u){var f,e;i==="entity"?(r==="state"?f=o:r==="error"&&(f=s),t.isObservable(n[f])&&p(n,f,u)):i==="property"&&t.isObservable(n[r])&&(e=n[r][c],e&&e(u))}function nt(n,i){var r=n[i];r&&(r[ft]=t.computed(function(){var u=n[s](),r;if(u&&u.ValidationErrors){r=t.utils.arrayFirst(u.ValidationErrors,function(n){return t.utils.arrayIndexOf(n.SourceMemberNames,i)>=0});if(r)return r.Message}return null}))}var u="koConfig",o="EntityState",s="EntityError",c="IsUpdated",b="IsAdded",y="IsDeleted",et="IsChanged",ot="CanDelete",ft="ValidationError",h=function(n,t,i,r){n.splice.apply(n,r?[t,i].concat(r):[t,i])},w=function(n){var t=i.isArray(n)?n.slice(0):n;return n&&n[i.cacheName]!==r&&(t[i.cacheName]=n[i.cacheName]),t},f=function(n,t){var r=i.cache(n,u);try{r&&(r.skip=!0),t()}finally{r&&(r.skip=!1)}},e=function(n,t,i){for(var r in n)n[r]===t&&(n[r]=i)},v=i.defineNamespace("upshot.observability");v.knockout={track:rt,insert:at,remove:ct,refresh:st,isProperty:ht,getProperty:d,setProperty:p,isArray:k,createCollection:g,asArray:it,map:l,unmap:a,setContextProperty:tt},v.configuration=v.knockout,i.addEntityProperties=function(n,r){n[o]=t.observable(i.EntityState.Unmodified),n[s]=t.observable();var f=function(i){return t.utils.arrayIndexOf(i,n[o]())!==-1},u=i.EntityState;n[c]=t.computed(function(){return f([u.ClientUpdated,u.ServerUpdating])}),n[b]=t.computed(function(){return f([u.ClientAdded,u.ServerAdding])}),n[y]=t.computed(function(){return f([u.ClientDeleted,u.ServerDeleting,u.Deleted])}),n[et]=t.computed(function(){return!f([u.Unmodified,u.Deleted])}),n[ot]=t.computed(function(){return!(n[b]()||n[y]())}),t.utils.arrayForEach(i.metadata.getProperties(n,r,!0),function(t){nt(n,t.name)})},i.addUpdatedProperties=function(n,r){t.utils.arrayForEach(i.metadata.getProperties(n,r,!1),function(i){var r=n[i.name];t.isObservable(r)&&(r[c]=t.observable(!1))})}})(this,ko,upshot);