(function(n,t,i){function e(n){if(!n||t.isFunction(n))return n;if(i.isArray(n))return t.map(n,function(n){var t=n.charAt(0)==="-",i=t?n.substr(1):n;return{property:i,descending:t}});var r=n.charAt(0)==="-",u=r?n.substr(1):n;return{property:u,descending:r}}function s(n){var e,o,r,f,u;if(!n)return n;for(n=i.isArray(n)?n:[n],e=[],o=0;o<n.length;o++){r=n[o];if(t.isFunction(r))e.push(r);else for(f in r)r.hasOwnProperty(f)&&(u=r[f],u&&u.hasOwnProperty("value")?e.push({property:f,operator:u.operator,value:u.value}):e.push({property:f,value:u}))}return e}function o(n){return n&&{skip:n.offset,take:n.limit,includeTotalCount:!!n.includeTotalCount}}var u=["refreshStart","refreshSuccess","refreshError","commitStart","commitSuccess","commitError","entityStateChanged","refreshNeeded"],f={paging:{setter:"setPaging",normalize:o},filter:{setter:"setFilter",normalize:s},sort:{setter:"setSort",normalize:e}};t.widget("upshot.dataview",t.ui.dataview,{_create:function(){var n=this;this.widgetEventPrefix="dataview",this.options.source=function(t,i,r){n.dataSource.refresh(t.refreshOptions,i,r)}},_init:function(){var n,i,r;this._super("_init"),this.dataSource=this._createDataSource(),this.result=this.dataSource.getEntities(),n=this,i={},t.each(u,function(r,u){i[u]=function(){t(n).trigger(u,arguments)}}),this._observer=i,this.dataSource.bind(i),r=Array.prototype.slice,t.each(["commitChanges","revertUpdates","revertChanges"],function(i,u){n.dataSource[u]&&(n[u]=function(){return n.dataSource[u].apply(n.dataSource,t.map(r.call(arguments),function(i){return t.proxy(i,n)||i}))})})},_destroy:function(){this._observer&&(this.dataSource.unbind(this._observer),this._observer=null),this._super("_destroy")},_setOption:function(n,i){var r=f[n];r?this.dataSource[r.setter](r.normalize(i)):this.dataSource.option(n,i&&t.inArray(n,u)>=0?t.proxy(i,this):i),this._super("_setOption",n,i)}}),t.widget("upshot.remoteDataview",t.upshot.dataview,{_createDataSource:function(){var r={},n,e;for(n in this.options)e=f[n],e?r[n]=e.normalize(this.options[n]):n!=="source"&&(r[n]=t.inArray(n,u)>=0?t.proxy(this.options[n],this):this.options[n]);return r.result=r.result||this.result,new i.RemoteDataSource(r)}}),t.widget("upshot.localDataview",t.upshot.dataview,{_createDataSource:function(){var r={},n,e;for(n in this.options)e=f[n],e?r[n]=e.normalize(this.options[n]):n==="input"?r.source=t.isArray(this.options.input)?this.options.input:this.options.input.dataSource:n!=="source"&&(r[n]=t.inArray(n,u)>=0?t.proxy(this.options[n],this):this.options[n]);return r.result=r.result||this.result,new i.LocalDataSource(r)}})})(this,jQuery,upshot);